### 05.02.2026
- Реализован мини клиент, сообщение от одного пользователя бродкастятся всем другим
- Бродкаст реализован через горутины и буфферизиорванный []byte канал
- Реализован gracefull shutdown
- Доступ к пулу соединений осуществляется через единый метод обёрнутый mutex для избежания data race
- Реализованы чаты, юзеры настроены логи, отрефакторил код, настроил DI через application и appinstance
- Настроил миграции через goose
- Реализовал базу данных и репозиторий с интерфейсами для postgres
- Реализовал методы интерфейсов репозитория с помощью gorm
- Настроил маршрутизацию с помощью chi

### 09.02.2026
- Реализована отправку токена у клиента
- Поставлена заглушка на токены и проверить работу с бд(чтобы сообщения сохранялись и грузились)
- Теперь сообщения корректно отправляются, сохраняются, подгружаются при получении всего чата

### 10.02.2026
- Отрефакторил код, вынес преобразования dto->domain, model->domain и наоборот в отдельные методы
- Переделал основную точку логирования, теперь все ошибки идут до handler, который логирует ошибку и возвращает её клиенту
- Реализовал универсальную функцию обработки и отправки ошибки клиенту для вебсокетов, дополнил такую же функцию для http
- Убрал лишние вызовы к базе данных (проверки существования перед вставкой и тд)
- Добавил маппер ошибок для репозитория 
- Исправлен баг: Получение чата всегда возвращает чат, даже если он не существует(вовзращает пустой)
- Исправлен баг: Если при бродкасте некоторые клиенты не получили сообщение, мы не узнаем об этом, так как игнорим ошибку(надо логировать)
- Исправлен баг: Username сейчас не сохраняется при создании сообщения и не отправляется клиенту при получении данных из бд

### 13.02.2026:
- Реализована сущность связи пользователь-чат, она хранит пользователя, чат, роль, заблокирован ли пользователь и дату
- Реализованы проверки роли и блокировки перед отправкой сообщения бродкастом

### 15.02.2026:
- Реализован метод для подписки на чат(привязка пользователя к чату)
- Реализован метод изменения роли и блокировки пользователя
- Методы для обработки связей вынесены отдельно, так как сильно обрастают логикой
- Разделил Mesage hub и message services, так как hub начал заниматься уже не теми вещами(работает с репозиториями и тд)
- начали переезд на events, теперь после получения сообщения из сокета сначала проверяем данные, доступы, потом создаём запись в бд и только после этого создаём событие в event bus, на который подписаны message hub, который бродкастит сообщение остальным пользователям

### 16.02.2026:
- новая инфраструкутра: переехали на events полностью
- новая логика: пользователи имеют роли и статусы для каждого чата, взависимости от них они могут выполнять те или иные действия, следит за этим permission service, на возможности пользователей так же влияет статус чата
- новый метод: обновление прав пользователей
- новый метод: добавление пользователя, по умолчанию выдаётся роль участника

- изменения: при создании чата пользователю выдаётся admin role
- изменения: метод получения чата теперь вовзращает еще и пользователей и их роли
- изменения: чаты имеют статус: публичный, приватный, канал

- исправлен баг: при получении чата не возвращается статус чата
- исправлен баг: Контекст из http передаётся в websocket и соединение отменяется по context canceled
- исправлен баг: повторный запрос на подписку не обрабатывает ошибку или другое поведение(повторяет подписку)


## TODO:
- Подвязать auth микросервис(взять protobuf из другого проекта и допилить его)
- метод бана другого пользователя в чате
- при получении чата нужно возвращать только user_id + user_name
- обновление роли и добавление пользователя - идемпотентный метод

## Баг:
- Пинг и понг не работают:
{"level":"error","time":"2026-02-09T14:24:07.726Z","logger":"app.message_websocket_api_http","caller":"handlers/messages_handler.go:92","msg":"ошибка отправки пинга: ","error":"websocket: close sent","stacktrace":"chatsockets/internal/interfaces/handlers.(*MessageHandler).writePump\n\t/app/internal/interfaces/handlers/messages_handler.go:92"}
- При получении сообщения именно из сокета(бродкастом от другого пользователя) слетают стили в веб клиенте
- Сообщения не отправляются, websocket падает при попытке отправки сообщения(подключение создаётся успешно)
